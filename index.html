<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kamisato Ayaka Shimeji</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
            background-color: #f9f9f9;
        }
        #shimejiCanvas {
            display: block;
            margin: 20px auto;
            border: 1px solid #ccc;
        }
        #debug {
            margin-top: 10px;
            font-size: 14px;
            color: #333;
        }
        .success {
            color: green;
        }
        .error {
            color: red;
        }
    </style>
</head>
<body>
    <h1>Kamisato Ayaka Shimeji</h1>
    <canvas id="shimejiCanvas" width="800" height="600"></canvas>
    <div id="debug"></div>

    <script>
        const canvas = document.getElementById("shimejiCanvas");
        const ctx = canvas.getContext("2d");
        const debugElement = document.getElementById("debug");

        const assets = ["walk1.png", "walk2.png", "stand1.png"]; // Add your asset names here.
        const loadedImages = {};
        let currentImageIndex = 0;

        const shimejiState = {
            x: 400, // Starting X position
            y: 300, // Starting Y position
            speed: 1, // Movement speed
            direction: 1, // 1 for right, -1 for left
            frameDelay: 10, // How many frames to wait before changing image
            currentFrame: 0, // Keeps track of the current frame
        };

        function loadAssets(assets) {
            let loadedCount = 0;

            return new Promise((resolve, reject) => {
                assets.forEach(asset => {
                    const img = new Image();
                    img.src = asset;
                    img.onload = () => {
                        loadedImages[asset] = img;
                        debugElement.innerHTML += `<div class="success">✔️ Loaded ${asset}</div>`;
                        loadedCount++;
                        if (loadedCount === assets.length) resolve();
                    };
                    img.onerror = () => {
                        debugElement.innerHTML += `<div class="error">❌ Failed to load ${asset}</div>`;
                        reject(`Failed to load ${asset}`);
                    };
                });
            });
        }

        function renderShimeji() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Update Shimeji's position
            shimejiState.x += shimejiState.speed * shimejiState.direction;

            // Reverse direction when hitting canvas edges
            if (shimejiState.x <= 0 || shimejiState.x >= canvas.width - 50) {
                shimejiState.direction *= -1; // Reverse direction
            }

            // Only change the image every few frames
            if (shimejiState.currentFrame >= shimejiState.frameDelay) {
                shimejiState.currentFrame = 0; // Reset frame counter
                currentImageIndex = (currentImageIndex + 1) % assets.length; // Cycle through images
            } else {
                shimejiState.currentFrame++; // Increment frame counter
            }

            const currentAsset = assets[currentImageIndex];
            const img = loadedImages[currentAsset];

            if (img) {
                // Flip the Shimeji when it changes direction
                ctx.save(); // Save the current canvas state
                if (shimejiState.direction === -1) {
                    ctx.scale(-1, 1); // Flip horizontally
                    ctx.drawImage(img, -shimejiState.x - 50, shimejiState.y, 50, 50);
                } else {
                    ctx.drawImage(img, shimejiState.x, shimejiState.y, 50, 50);
                }
                ctx.restore(); // Restore the canvas state
            }

            requestAnimationFrame(renderShimeji); // Smooth animation
        }

        (async function init() {
            debugElement.textContent = "Loading assets...";
            try {
                await loadAssets(assets);
                debugElement.innerHTML += "<div class='success'>✅ All assets loaded successfully!</div>";
                renderShimeji();
            } catch (error) {
                debugElement.innerHTML += `<div class="error">❌ Error: ${error}</div>`;
            }
        })();
    </script>
</body>
</html>